<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ“Š é¢ç©æ¯”å¯¾å¿œ 4æŠã‚¯ã‚¤ã‚ºï¼ˆæ¨ªå¹…çµ±ä¸€ï¼‰</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js" defer></script>
<style>
  body{font-family:"Segoe UI",sans-serif;margin:0;padding:0;background:#f8f9fa;text-align:center}
  h1{font-size:1.1rem;margin:8px 0}
  #modeSelection,#gameContainer{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}
  #mainChart{width:95%;max-width:420px;height:200px;margin:4px auto}
  #options{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;width:95%;max-width:420px;margin-top:4px}
  .option-box{border:2px solid #ccc;border-radius:6px;background:#fff;padding:4px;transition:0.15s}
  .option-box:hover{border-color:#007BFF;transform:scale(1.02)}
  .option-plot{width:100%;height:70px}
  .correct{border-color:#00c853 !important;background:#eaffea}
  .wrong{border-color:#ff1744 !important;background:#ffeaea}
  button{font-size:1rem;padding:8px 16px;margin-top:6px;border:none;border-radius:5px;color:#fff;cursor:pointer}
  #startButton{background:#007BFF}#startButton:hover{background:#0056b3}
  #checkButton{background:#28a745}#checkButton:hover{background:#218838}
  #nextButton{background:#007BFF;display:none}
  #restartButton{background:#6c757d;display:none}
  #life{font-size:1.1rem;color:red;margin:6px}
  #message{font-size:1rem;min-height:1.5em}
  #scoreboard,#finalScore{font-size:1rem;color:#333;margin:4px}
  @media(max-width:480px){button{width:90%;font-size:0.9rem}.option-plot{height:65px}#mainChart{height:180px}}
</style>
</head>
<body>

<div id="modeSelection">
  <h1>ğŸ“Š ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ  â†’ ç®±ã²ã’å›³ 4æŠã‚¯ã‚¤ã‚º</h1>
  <p>åˆ†å¸ƒã®å½¢ã‚’è¦‹ã¦å¯¾å¿œã™ã‚‹ç®±ã²ã’å›³ã‚’é¸ã¼ã†ï¼</p>
  <button id="startButton">ã‚²ãƒ¼ãƒ é–‹å§‹ â–¶ï¸</button>
</div>

<div id="gameContainer" style="display:none;">
  <h1>ğŸ“Š ã‚¯ã‚¤ã‚º</h1>
  <div id="life"></div>
  <div id="mainChart"></div>
  <div id="options"></div>

  <button id="checkButton">âœ… ç­”ãˆåˆã‚ã›</button>
  <div id="message"></div>
  <div id="scoreboard"></div>
  <div id="finalScore" style="display:none;font-weight:bold"></div>

  <button id="nextButton">ğŸ” æ¬¡ã®å•é¡Œã¸</button>
  <button id="restartButton">ğŸ”„ å§‹ã‚ã‹ã‚‰</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const baseDist = ["æ­£è¦åˆ†å¸ƒ","å³ã«æ­ªã‚“ã åˆ†å¸ƒ","å·¦ã«æ­ªã‚“ã åˆ†å¸ƒ"];
  const optionalDist = ["ä¸€æ§˜åˆ†å¸ƒ","äºŒå³°æ€§åˆ†å¸ƒ"];
  const X_RANGE = [-10, 10]; // âœ… æ¨ªå¹…ã‚’çµ±ä¸€

  let distTypes = [];
  let totalQuestions=0,correctAnswers=0,currentAnswer=0;
  let lives=3,correctType="",waitingNext=false;

  function randn(mean=0,std=1){
    let u=1-Math.random(),v=1-Math.random();
    return mean+std*Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v);
  }

  const histPatterns={
    "æ­£è¦åˆ†å¸ƒ":[{mean:0,std:1}],
    "å³ã«æ­ªã‚“ã åˆ†å¸ƒ":[{scale:2,bias:3}],
    "å·¦ã«æ­ªã‚“ã åˆ†å¸ƒ":[{scale:2,bias:-3}],
    "äºŒå³°æ€§åˆ†å¸ƒ":[{offset:3.5}],
    "ä¸€æ§˜åˆ†å¸ƒ":[{range:10}]
  };

  function generateHistogramData(type){
    const n=200;
    let scaleFactor=1;
    switch(type){
      case "æ­£è¦åˆ†å¸ƒ": scaleFactor=1.0; break;
      case "å³ã«æ­ªã‚“ã åˆ†å¸ƒ": scaleFactor=0.7; break;
      case "å·¦ã«æ­ªã‚“ã åˆ†å¸ƒ": scaleFactor=0.7; break;
      case "äºŒå³°æ€§åˆ†å¸ƒ": scaleFactor=1.3; break;
      case "ä¸€æ§˜åˆ†å¸ƒ": scaleFactor=1.0; break;
    }

    if(type==="ä¸€æ§˜åˆ†å¸ƒ" || Math.random()<0.2){
      const range=10*scaleFactor;
      return Array.from({length:n},()=> (Math.random()-0.5)*range);
    }

    const p=histPatterns[type][0];
    if(type==="æ­£è¦åˆ†å¸ƒ")
      return Array.from({length:n},()=>randn(p.mean,p.std*scaleFactor));
    if(type==="å³ã«æ­ªã‚“ã åˆ†å¸ƒ")
      return Array.from({length:n},()=>Math.pow(Math.abs(randn(0,1)),1.8)*p.scale*scaleFactor+p.bias);
    if(type==="å·¦ã«æ­ªã‚“ã åˆ†å¸ƒ")
      return Array.from({length:n},()=>-Math.pow(Math.abs(randn(0,1)),1.8)*p.scale*scaleFactor+p.bias);
    if(type==="äºŒå³°æ€§åˆ†å¸ƒ"){
      const a=Array.from({length:n/2},()=>randn(-p.offset,0.7*scaleFactor));
      const b=Array.from({length:n/2},()=>randn(p.offset,0.7*scaleFactor));
      return a.concat(b);
    }
  }

  function generateBoxStats(type){
    let scaleFactor=1;
    switch(type){
      case "æ­£è¦åˆ†å¸ƒ": scaleFactor=1.0; break;
      case "å³ã«æ­ªã‚“ã åˆ†å¸ƒ": scaleFactor=0.7; break;
      case "å·¦ã«æ­ªã‚“ã åˆ†å¸ƒ": scaleFactor=0.7; break;
      case "äºŒå³°æ€§åˆ†å¸ƒ": scaleFactor=1.3; break;
      case "ä¸€æ§˜åˆ†å¸ƒ": scaleFactor=1.0; break;
    }

    const base={
      "æ­£è¦åˆ†å¸ƒ":{min:-3,q1:-1,med:0,q3:1,max:3},
      "å³ã«æ­ªã‚“ã åˆ†å¸ƒ":{min:-1,q1:0.5,med:1.5,q3:3,max:8},
      "å·¦ã«æ­ªã‚“ã åˆ†å¸ƒ":{min:-8,q1:-3,med:-1.5,q3:-0.5,max:1},
      "äºŒå³°æ€§åˆ†å¸ƒ":{min:-8,q1:-4,med:0,q3:4,max:8},
      "ä¸€æ§˜åˆ†å¸ƒ":{min:-5,q1:-2.5,med:0,q3:2.5,max:5}
    }[type];

    const mid=base.med;
    const q1=mid+(base.q1-mid)*scaleFactor;
    const q3=mid+(base.q3-mid)*scaleFactor;
    const min=mid+(base.min-mid)*scaleFactor;
    const max=mid+(base.max-mid)*scaleFactor;
    return {min,q1,med:mid,q3,max};
  }

  function synthesizeArray(stats,n=200){
    const segs=[
      {f:stats.min,t:stats.q1,r:0.25},
      {f:stats.q1,t:stats.med,r:0.25},
      {f:stats.med,t:stats.q3,r:0.25},
      {f:stats.q3,t:stats.max,r:0.25}
    ];
    const arr=[];
    for(const seg of segs){
      const cnt=Math.max(1,Math.floor(n*seg.r));
      for(let i=0;i<cnt;i++){
        const u=Math.random();
        const v=seg.f+u*(seg.t-seg.f)+(Math.random()-0.5)*((seg.t-seg.f)*0.1);
        arr.push(v);
      }
    }
    return arr;
  }

  function updateLifeDisplay(){
    document.getElementById("life").innerHTML="â¤ï¸".repeat(lives)+"ğŸ¤".repeat(3-lives);
  }

  function drawQuestion(){
    waitingNext=false;
    document.getElementById("message").innerText="";
    document.getElementById("finalScore").style.display="none";
    document.getElementById("nextButton").style.display="none";
    document.getElementById("checkButton").style.display="inline-block";

    const lastDist = ["ä¸€æ§˜åˆ†å¸ƒ","äºŒå³°æ€§åˆ†å¸ƒ"][Math.floor(Math.random()*2)];
    distTypes = ["æ­£è¦åˆ†å¸ƒ","å³ã«æ­ªã‚“ã åˆ†å¸ƒ","å·¦ã«æ­ªã‚“ã åˆ†å¸ƒ", lastDist];

    correctType = distTypes[Math.floor(Math.random()*distTypes.length)];
    currentAnswer = distTypes.indexOf(correctType);

    const mainData=generateHistogramData(correctType);
    Plotly.react("mainChart", [{
      x: mainData,
      type: "histogram",
      xbins: {size: 1},
      marker: {color: "lightgray", line: {color: "gray", width: 1}},
      opacity: 1
    }],
    {margin:{t:30,l:10,r:10,b:10},xaxis:{range:X_RANGE,visible:false},yaxis:{visible:false}},
    {staticPlot:true});

    const options=document.getElementById("options");
    options.innerHTML="";
    distTypes.forEach((type,i)=>{
      const stats=generateBoxStats(type);
      const arr=synthesizeArray(stats,200);
      const div=document.createElement("div");
      div.className="option-box";div.dataset.index=i;
      div.innerHTML=`<div id="box${i}" class="option-plot"></div>`;
      options.appendChild(div);

      Plotly.newPlot(`box${i}`,[{x:arr,type:"box",boxpoints:false,orientation:"h",
        marker:{color:"rgba(80,80,80,0.6)"}}],
        {margin:{t:5,b:5,l:5,r:5},xaxis:{range:X_RANGE,visible:false},yaxis:{visible:false}},
        {staticPlot:true});

      div.addEventListener("click",()=>{
        document.querySelectorAll(".option-box").forEach(b=>b.style.outline="");
        div.style.outline="2px solid #007BFF";
        options.dataset.selected=i;
      });
    });

    updateLifeDisplay();
  }

  document.getElementById("checkButton").addEventListener("click",()=>{
    if(waitingNext)return;
    const sel=document.getElementById("options").dataset.selected;
    if(sel===undefined){alert("é¸æŠè‚¢ã‚’é¸ã‚“ã§ãã ã•ã„ï¼");return;}
    waitingNext=true;totalQuestions++;
    const ans=parseInt(sel);
    const msg=document.getElementById("message");
    if(ans===currentAnswer){
      correctAnswers++;
      msg.innerText="ğŸ¯ æ­£è§£ï¼";
      msg.style.color="green";
      document.querySelectorAll(".option-box")[ans].classList.add("correct");
    }else{
      lives--;
      msg.innerText="âŒ ä¸æ­£è§£";
      msg.style.color="red";
      document.querySelectorAll(".option-box")[ans].classList.add("wrong");
      document.querySelectorAll(".option-box")[currentAnswer].classList.add("correct");
    }
    updateLifeDisplay();
    document.getElementById("scoreboard").innerText=`åˆè¨ˆæ­£è§£ï¼š${correctAnswers}å•`;
    document.getElementById("checkButton").style.display="none";
    document.getElementById("nextButton").style.display="inline-block";
    if(lives<=0){
      const rate=((correctAnswers/totalQuestions)*100).toFixed(1);
      msg.innerText="ğŸ’€ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼";
      document.getElementById("nextButton").style.display="none";
      document.getElementById("restartButton").style.display="inline-block";
      const fs=document.getElementById("finalScore");
      fs.style.display="block";
      fs.innerHTML=`ğŸ æœ€çµ‚ã‚¹ã‚³ã‚¢<br>æ­£è§£æ•°ï¼š${correctAnswers}å• / ${totalQuestions}å•<br>æ­£ç­”ç‡ï¼š${rate}%`;
    }
  });

  document.getElementById("nextButton").addEventListener("click",()=>drawQuestion());
  document.getElementById("startButton").addEventListener("click",()=>{
    document.getElementById("modeSelection").style.display="none";
    document.getElementById("gameContainer").style.display="flex";
    totalQuestions=0;correctAnswers=0;lives=3;
    drawQuestion();
  });
  document.getElementById("restartButton").addEventListener("click",()=>{
    document.getElementById("gameContainer").style.display="none";
    document.getElementById("modeSelection").style.display="flex";
  });
});
</script>
</body>
</html>
